<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.solvd.airport.persistence.AircarrierRepository">

    <insert id="create" keyProperty="id" useGeneratedKeys="true">
        Insert into aircarriers(name) values (#{name})
    </insert>

    <select id="readById" resultMap="AircarrierResultMap">
        Select id as aircarrier_id, name as aircarrier_name from aircarriers where id = #{id}
    </select>

    <select id="readAll" resultMap="AircarrierResultMap">
        select
        aircarriers.id as aircarrier_id,
        aircarriers.name as aircarrier_name,
        aircrafts.id as aircraft_id,
        aircrafts.number as aircraft_number,
        aircrafts.model as aircraft_model,
        pilots.id as pilot_id,
        pilots.name as pilot_name
        FROM aircarriers
        left join pilots on aircarriers.id = pilots.aircarrier_id
        left join aircrafts on aircarriers.id = aircrafts.aircarrier_id
        order by aircarriers.id;
    </select>

    <update id="update" keyProperty="id" useGeneratedKeys="true">
        update aircarriers set name = #{name} where id = #{id}
    </update>

    <delete id="deleteById" >
        delete from aircarriers where id = #{id}
    </delete>

    <resultMap id="AircarrierResultMap" type="com.solvd.airport.domain.carrier.Aircarrier" autoMapping="false">
        <id property="id" column="aircarrier_id" />
        <result property="name" column="aircarrier_name"/>
        <collection property="aircrafts"
                     resultMap="com.solvd.airport.persistence.AircraftRepository.AircraftResultMap"/>
    </resultMap>
</mapper>
